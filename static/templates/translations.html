<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ã“mar B - Translations</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.3.0/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="{{url_for('static', filename='main.css')}}">
    
    <script type="text/javascript">
      async function fetchProgress() {
        try {
          const response = await fetch("http://127.0.0.1:5000/translation_progress");
          const data = await response.json();
          
          const total = data.completed + data.inProgress + data.remaining;
          const completedPercentage = (data.completed / total) * 100;
          const inProgressPercentage = (data.inProgress / total) * 100;
          const remainingPercentage = (data.remaining / total) * 100;
          
          document.getElementById("progress-completed").style.width = completedPercentage + "%";
          document.getElementById("progress-inprogress").style.width = inProgressPercentage + "%";
          document.getElementById("progress-remaining").style.width = remainingPercentage + "%";
        } catch (error) {
          console.error("Error fetching progress:", error);
        }
      }
      
      async function updateSpotifyEmbed() {
        try {
          console.log("Fart")
          const response = await fetch("http://127.0.0.1:5000/get_current_song_id");
          const data = await response.json();
          
          const songId = data.song_id;
          if (songId) {
            document.getElementById("spotify-embed").src = `https://open.spotify.com/embed/track/${songId}?utm_source=generator&theme=0`;
          }
        } catch (error) {
          console.error("Error fetching current song:", error);
        }
      }
      
      fetchProgress();
      updateSpotifyEmbed();
    </script>
  </head>
  
  <body>
    <!--Navigation Bar-->
    <script id="replace_with_navbar" src="{{url_for('static', filename='javascript/navbar.js')}}"></script>
    
    <!--Total study time-->
    <div id="study-time" style="text-align: center; font-size: 20px; font-weight: bold; margin-top: 10px;"></div>
    <script>
        async function updateStudyTime() {
            try {
                let response = await fetch('http://127.0.0.1:5000/get_total_study');
                let data = await response.json();
                document.getElementById('study-time').innerText = `Total time spent translating: ${data.hours}h ${data.minutes}m`;
            } catch (error) {
                console.error('Error fetching study time:', error);
            }
        }

        updateStudyTime();
    </script>

    <!--Progress bar-->
    <div class="container mt-4" style="margin-bottom: 20px;">
      <div class="progress" style="height: 50px;">
        <div id="progress-completed" class="progress-bar bg-success" style="width: 0%"></div>
        <div id="progress-inprogress" class="progress-bar bg-warning" style="width: 0%"></div>
        <div id="progress-remaining" class="progress-bar bg-danger" style="width: 0%"></div>
      </div>
    </div>

    <!--Title-->
    <h1 style="margin-bottom: 20px;" id="center_this">The <em>Asian Kung-Fu Generation</em> translation project</h1>

    <!--Description and current song-->
    <div class="container">
      <div class="row">
        <div class="col-sm" id=study-time>
          <div class="card text-white bg-dark mb-3" style="max-width: 40rem;">
            <div class="card-body">
              <h5 class="card-title">Project Preamble</h5>
              <p class="card-text"><br>2 things are important to note for this project<br>
                - I've been studying Japanese since September 2023<br>
                - I've been a fan of <em>Asian Kung-Fu Generation</em> for <strong>way</strong> longer than that<br>
                <br>
                So I thought to myself, "why don't I just translate all of my favorite AKFG songs?"
              </p>
            </div>
          </div>
          
        </div>
        <div class="col-sm">

          <div class="card text-white bg-dark mb-3" style="max-width: 40rem;">
            <div class="card-body">
              <h5 class="card-title">Currently translating:</h5>
              <p class="card-text"><iframe id="spotify-embed" style="border-radius:12px" src="https://open.spotify.com/embed/track/4EZnEUoKYVG5wfx5pF8Gb7?utm_source=generator&theme=0" width="100%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe></p>
            </div>
          </div>
        </div>
      </div>

    </div>

    <!--Main Project Description-->
    <div class="card text-center text-white bg-dark mb-3">
      <div class="card-body">
        <h5 class="card-title">Project Description</h5>
        <p class="card-text">I started by using the Spotify API to get a list</p>
      </div>
    </div>
  </body>
</html>
